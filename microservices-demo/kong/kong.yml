_format_version: "3.0"

services:
  - name: user-service
    url: http://user-service:3001
    routes:
      - name: user-health
        paths:
          - /users/health
        strip_path: false
        methods:
          - GET
      - name: user-stats
        paths:
          - /users/stats
        strip_path: false
        methods:
          - GET
      - name: user-api
        paths:
          - /users
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - PATCH
          - DELETE
          - OPTIONS

  - name: todo-service
    url: http://todo-service:8000
    routes:
      - name: todo-health
        paths:
          - /todos/health
        strip_path: false
        methods:
          - GET
      - name: todo-api
        paths:
          - /todos
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - PATCH
          - DELETE
          - OPTIONS

  - name: kong-health
    url: http://kong:8001
    routes:
      - name: gateway-health
        paths:
          - /health
        strip_path: true
        methods:
          - GET

plugins:
  - name: cors
    config:
      origins:
        - "http://localhost:3000"
        - "http://localhost:8000"
      methods:
        - GET
        - POST
        - PUT
        - PATCH
        - DELETE
        - OPTIONS
      headers:
        - Accept
        - Authorization
        - Content-Type
        - X-Requested-With
      credentials: true
  - name: request-transformer
    config:
      add:
        headers:
          - "X-Forwarded-Host:localhost:8000"
      replace:
        headers: []
